---
export interface Props {
  title?: string;
  favicon?: string;
  description?: string;
  author?: string;
  generator?: string;
  canonical?: string;
}

const {
  title,
  description,
  favicon,
  author,
  generator,
  canonical = decodeURI(Astro.url.href)
} = Astro.props;
import "@fontsource-variable/inter";
import "@fontsource-variable/fira-code";
import "@/styles/global.css";
// import "/styles/ch-style.css"

import { ViewTransitions } from "astro:transitions";
import ProgressBar from "@/components/ProgressBar";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" href={favicon} />
    {title && <title>{title}</title>}
    {description && <meta name="description" content={description} />}
    {author && <meta name="author" content={author} />}
    {generator && <meta name="generator" content={generator} />}
    {canonical && <link rel="canonical" href={canonical} />}
    <script is:inline>
      (function() {
        const storedTheme = JSON.parse(window.localStorage.getItem('theme') ?? '"auto"');
        let presetTheme;
        if (storedTheme === 'auto') {
          presetTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        } else {
          presetTheme = storedTheme;
        }
        if (presetTheme === 'dark') {
          document.documentElement.classList.add('dark');
          document.documentElement.style.colorScheme = 'dark';
        } else {
          document.documentElement.classList.remove('dark');
          document.documentElement.style.colorScheme = 'light';
        }
      })()
    </script>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KB3C51DXE1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KB3C51DXE1');
</script>
<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?addd4410264cc254e5d2e0c1f16ef400";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
<!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "f85cd2bfce234a41a68eee1ae2d4f2e7"}'></script><!-- End Cloudflare Web Analytics -->  
    <ViewTransitions />
    <slot name="head" />
  </head>
  <body class="min-h-screen flex flex-col">
    <noscript>
      <div class="pt-16 text-center font-bold text-xl" >Enable JavaScript to run this website.</div>
    </noscript>
    <slot />
    <ProgressBar client:load transition:persist="progress-bar" />
  </body>
</html>

<script>
  // prevent flash when using view transitions in astro
  const setDarkMode = () => {
    const storedTheme = JSON.parse(window.localStorage.getItem('theme') ?? '"auto"');
    let presetTheme;
    if (storedTheme === 'auto') {
      presetTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    } else {
      presetTheme = storedTheme;
    }
    if (presetTheme === 'dark') {
      document.documentElement.classList.add('dark');
      document.documentElement.style.colorScheme = 'dark';
    } else {
      document.documentElement.classList.remove('dark');
      document.documentElement.style.colorScheme = 'light';
    }
  };

  // Runs on initial navigation
  setDarkMode();
  // Runs on view transitions navigation
  document.addEventListener('astro:after-swap', setDarkMode);
</script>